# common logging configuration see common scala
include "logging"

# see http://spray.io/documentation/spray-can/configuration/
# descriptions inlined below for convenience
spray.can.server {
   # Description:
   # If a request hasn't been responded to after the time period set here
   # a `spray.http.Timedout` message will be sent to the timeout handler.
   # Set to `infinite` to completely disable request timeouts.
   #
   # Explaining the set value:
   # The controller holds connections up to 60s for blocking invokes, and
   # all other operations are expected to complete quickly. We allow a grace
   # period in addition to the blocking invoke timeout.
  request-timeout = 90s

  # Description:
  # Enables/disables support for statistics collection and querying.
  # Even though stats keeping overhead is small,
  # for maximum performance switch off when not needed.
  stats-support = off

  # Description:
  # The time after which an idle connection will be automatically closed.
  # Set to `infinite` to completely disable idle connection timeouts.
  #
  # Explaining the set value:
  # This must be greater than the request timeout.
  idle-timeout = 120s

  parsing {
    # This indirectly puts a bound on the name of entities
    # 8k matches nginx default
    max-uri-length = 8k

    # This is 50MB to allow action attachments
    max-content-length = 50m
  }

  # The maximum number of requests that are accepted (and dispatched to
  # the application) on one single connection before the first request
  # has to be completed.
  # Incoming requests that would cause the pipelining limit to be exceeded
  # are not read from the connections socket so as to build up "back-pressure"
  # to the client via TCP flow control.
  # A setting of 1 disables HTTP pipelining, since only one request per
  # connection can be "open" (i.e. being processed by the application) at any
  # time. Set to higher values to enable HTTP pipelining.
  # Set to 'disabled' for completely disabling pipelining limits
  # (not recommended on public-facing servers due to risk of DoS attacks).
  # This value must be > 0 and <= 128.
  pipelining-limit = 128

  # The time period within which a connection handler must have been
  # registered after the bind handler has received a `Connected` event.
  # Set to `infinite` to disable.
  registration-timeout = 10s
}
#spray.can.host-connector {
#  # The maximum number of parallel connections that an `HttpHostConnector`
#  # is allowed to establish to a host. Must be greater than zero.
#  # (default 4)
#  max-connections = 128
#
#  # If this setting is enabled, the `HttpHostConnector` pipelines requests
#  # across connections, otherwise only one single request can be "open"
#  # on a particular HTTP connection.
#  # (default off)
#  pipelining = on
#}
akka.http {
  client {
    parsing.illegal-header-warnings = off
    parsing.max-chunk-size = 50m
  }

  host-connection-pool {
    max-connections = 1024
    max-open-requests = 1024
    #1048576
    pipelining-limit = 128
  }
}

whisk.mesos.max-concurrent = 500
#current settings in CONTROLLER_OPTS:
#-Xmx2048m -Dakka.http.host-connection-pool.max-open-requests=2048 -Dwhisk.mesos.max-concurrent=400 -Dspray.can.server.registration-timeout=10s -Dakka.loglevel=WARNING -Dwhisk.mesos.master-url=http://master.mesos:5050
